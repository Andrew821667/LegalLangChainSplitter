# LegalLangChainSplitter

–ú–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∞–≤–æ–≤—ã—Ö –∞–∫—Ç–æ–≤ —Å —á–∞–Ω–∫–∏–Ω–≥–æ–º –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

## –û–ø–∏—Å–∞–Ω–∏–µ

- **LegalLangChainSplitter** - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–ª–∏—Ç—Ç–µ—Ä –¥–ª—è –ø—Ä–∞–≤–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ LangChain
- **AdaptiveQualityValidator** - –≤–∞–ª–∏–¥–∞—Ç–æ—Ä —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏ (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å +200% –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –±–∞–∑–æ–≤—ã–º)
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Django –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–ø–ª–∏—Ç—Ç–µ—Ä–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ç–∞–±–ª–∏—Ü

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- –ö–∞—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–∏–Ω–≥–∞: 100% –Ω–∞ –ø—Ä–∞–≤–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö/—Å—Ä–µ–¥–Ω–∏—Ö/–¥–ª–∏–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤  
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–±–∏–µ–Ω–∏—è (markdown/recursive)
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã/—Ç–æ–∫–µ–Ω—ã: 2.37 (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –ø—Ä–æ–µ–∫—Ç knowledge_base

### 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ø–ª–∏—Ç—Ç–µ—Ä
cp splitters/legal_langchain_splitter.py knowledge_base/app_chunks/splitters/

# –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ (–µ—Å–ª–∏ –Ω–µ—Ç)
mkdir -p knowledge_base/app_chunks/services/validators

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä
cp validators/adaptive_validator.py knowledge_base/app_chunks/services/validators/

# –°–æ–∑–¥–∞—Ç—å __init__.py –≤ –ø–∞–ø–∫–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤
touch knowledge_base/app_chunks/services/validators/__init__.py
```

### 2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ

–î–æ–±–∞–≤–∏—Ç—å –≤ —Ñ–∞–π–ª `knowledge_base/app_chunks/apps.py`:

```python
# –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç
from app_chunks.splitters.legal_langchain_splitter import LegalLangChainSplitter

# –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ –º–µ—Ç–æ–¥–µ ready()
register_splitter(LegalLangChainSplitter)
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

```python
# –í Django shell –∏–ª–∏ views
from app_chunks.splitters.registry import CHUNK_SPLITTER_REGISTRY
print(CHUNK_SPLITTER_REGISTRY.keys())  # –î–æ–ª–∂–µ–Ω –±—ã—Ç—å LegalLangChainSplitter

from app_chunks.services.validators.adaptive_validator import AdaptiveQualityValidator
validator = AdaptiveQualityValidator()  # –î–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ø–ª–∏—Ç—Ç–µ—Ä–∞

```python
from app_chunks.splitters.dispatcher import SplitterDispatcher

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
config = {
    "min_chunk_size": 500,
    "max_chunk_size": 1200,
    "chunk_overlap": 100,
    "encoding_name": "cl100k_base"
}

# –°–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –¥–∏—Å–ø–µ—Ç—á–µ—Ä
splitter = SplitterDispatcher.create_instance(
    'app_chunks.splitters.legal_langchain_splitter.LegalLangChainSplitter',
    config
)

# –ß–∞–Ω–∫–∏–Ω–≥ –¥–æ–∫—É–º–µ–Ω—Ç–∞
metadata = {
    "title": "–§–ó –û –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö",
    "document_type": "federal_law",
    "legal_document": True
}

chunks = splitter.split(metadata, legal_text)
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞

```python
from app_chunks.services.validators.adaptive_validator import AdaptiveQualityValidator

validator = AdaptiveQualityValidator()
result = validator.validate_chunks(chunks)

print(f"–ö–∞—á–µ—Å—Ç–≤–æ: {result['quality_score']:.1f}%")
print(f"–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞: {result['document_type']}")
print(f"–í–∞–ª–∏–¥–∞—Ü–∏—è: {'–ü—Ä–æ–π–¥–µ–Ω–∞' if result['valid'] else '–ù–µ –ø—Ä–æ–π–¥–µ–Ω–∞'}")
```

### –í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–ø–ª–∏—Ç—Ç–µ—Ä "LangChain Legal" –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ø–ª–∏—Ç—Ç–µ—Ä–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —Å–∏—Å—Ç–µ–º—ã.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ä–∞–∑–±–∏–µ–Ω–∏—è:

- **Markdown —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** - –µ—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- **–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** - –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** - –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

- **–ö–æ—Ä–æ—Ç–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã** (<5000 —Å–∏–º–≤–æ–ª–æ–≤): –ø–æ—Ä–æ–≥ –∫–∞—á–µ—Å—Ç–≤–∞ 40%
- **–°—Ä–µ–¥–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã** (5000-20000 —Å–∏–º–≤–æ–ª–æ–≤): –ø–æ—Ä–æ–≥ –∫–∞—á–µ—Å—Ç–≤–∞ 60%
- **–î–ª–∏–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã** (>20000 —Å–∏–º–≤–æ–ª–æ–≤): –ø–æ—Ä–æ–≥ –∫–∞—á–µ—Å—Ç–≤–∞ 70%

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `langchain-text-splitters` >= 0.2.0
- `langchain-core` >= 0.2.0
- `tiktoken` >= 0.5.0
- `Django` (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–æ–π)

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –º–æ–¥–µ–ª—å—é `Chunk` –≤ –ë–î
- –°–æ–≤–º–µ—Å—Ç–∏–º —Å —Å–∏—Å—Ç–µ–º–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–ø–ª–∏—Ç—Ç–µ—Ä–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å `SplitterDispatcher`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

## –ê–≤—Ç–æ—Ä

Andrew821667

## –õ–∏—Ü–µ–Ω–∑–∏—è

–û—Ç–∫—Ä—ã—Ç—ã–π –∫–æ–¥ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –ø—Ä–æ–µ–∫—Ç knowledge_base.


## üîÑ –û–ë–ù–û–í–õ–ï–ù–ò–ï: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Ç–æ–∫–µ–Ω—ã (–≤–µ—Ä—Å–∏—è 2.0)

### ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- **–ó–∞–º–µ–Ω–µ–Ω –ø–æ–¥—Å—á–µ—Ç —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —Ç–æ–∫–µ–Ω—ã** –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å knowledge_base
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `tiktoken` –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤
- –†–∞–∑–º–µ—Ä—ã —á–∞–Ω–∫–æ–≤ —Ç–µ–ø–µ—Ä—å –≤ —Ç–æ–∫–µ–Ω–∞—Ö: **500-1200 —Ç–æ–∫–µ–Ω–æ–≤**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–ª–∫–∏—Ö —á–∞–Ω–∫–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö –ø—Ä–∞–≤–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- **100% —á–∞–Ω–∫–æ–≤ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ** –Ω–∞ –¥–ª–∏–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã/—Ç–æ–∫–µ–Ω—ã: **~2.37** (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ)
- –ú–∏–Ω–∏–º—É–º: **644 —Ç–æ–∫–µ–Ω–æ–≤**, –ú–∞–∫—Å–∏–º—É–º: **763 —Ç–æ–∫–µ–Ω–æ–≤**
- –°—Ä–µ–¥–Ω–µ–µ: **738 —Ç–æ–∫–µ–Ω–æ–≤**

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```python
# –ë—ã–ª–æ (—Å–∏–º–≤–æ–ª—ã):
length_function=len
chunk_size=1200  # —Å–∏–º–≤–æ–ª–æ–≤

# –°—Ç–∞–ª–æ (—Ç–æ–∫–µ–Ω—ã):
RecursiveCharacterTextSplitter.from_tiktoken_encoder()
chunk_size=1200  # —Ç–æ–∫–µ–Ω–æ–≤
```

### üéØ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- ‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø—Ä–æ–µ–∫—Ç–æ–º knowledge_base
- ‚úÖ –í—Å–µ API –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –†–∞–∑–º–µ—Ä—ã 500-1200 –æ—Å—Ç–∞–ª–∏—Å—å, –Ω–æ —Ç–µ–ø–µ—Ä—å –≤ —Ç–æ–∫–µ–Ω–∞—Ö
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–∏—Ö –ø—Ä–∞–≤–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### üìù –ú–∏–≥—Ä–∞—Ü–∏—è:
–ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–π –∂–µ, –Ω–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –≤–º–µ—Å—Ç–æ —Å–∏–º–≤–æ–ª–æ–≤.
